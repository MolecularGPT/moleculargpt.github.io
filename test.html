<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Текст в Молекулу | Универсальное Стандартизированное Молекулярное API</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Дизайн-токены */
            --color-bg-primary: #0a1929;
            --color-bg-secondary: #071220;
            --color-bg-card: #112240;
            --color-bg-input: #1a365d;
            --color-accent-teal: #00f5d4;
            --color-accent-purple: #9d4edd;
            --color-accent-pink: #ff6b9d;
            --color-text-primary: #e6f1ff;
            --color-text-secondary: #8892b0;
            --color-text-muted: #64748b;
            --color-border: #1e406e;
            --color-success: #00d68f;
            --color-warning: #ffaa00;
            --color-error: #ff3d71;
            
            /* Типография */
            --font-primary: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            
            /* Пространства */
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 2rem;
            --spacing-lg: 3rem;
            --spacing-xl: 5rem;
            
            /* Радиусы */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            
            /* Тени */
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.4);
            --shadow-glow-teal: 0 0 15px rgba(0, 245, 212, 0.5);
            --shadow-glow-purple: 0 0 15px rgba(157, 78, 221, 0.5);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: var(--font-primary);
            background-color: var(--color-bg-primary);
            color: var(--color-text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-md);
        }
        
        /* Хедер */
        .header {
            padding: var(--spacing-md) 0;
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: rgba(10, 25, 41, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--color-border);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--color-accent-teal), var(--color-accent-purple));
            border-radius: var(--radius-md);
            font-size: 24px;
            color: var(--color-bg-primary);
        }
        
        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--color-accent-teal), var(--color-accent-purple));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        /* Герой секция */
        .hero {
            padding: var(--spacing-xl) 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 30%, rgba(0, 245, 212, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .hero-title {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: var(--spacing-sm);
            line-height: 1.1;
            background: linear-gradient(to right, var(--color-text-primary), var(--color-accent-teal));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .hero-subtitle {
            font-size: 1.5rem;
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-lg);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* Диалоговое окно */
        .dialog-container {
            max-width: 900px;
            margin: 0 auto var(--spacing-xl);
            border-radius: var(--radius-xl);
            background-color: var(--color-bg-card);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            border: 1px solid var(--color-border);
            position: relative;
        }
        
        .dialog-header {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(17, 34, 64, 0.8);
        }
        
        .dialog-title {
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }
        
        .dialog-title i {
            color: var(--color-accent-teal);
        }
        
        .pipeline-stages {
            display: flex;
            gap: var(--spacing-sm);
        }
        
        .stage-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--color-text-muted);
            transition: all 0.3s ease;
        }
        
        .stage-indicator.active {
            background-color: var(--color-accent-teal);
            box-shadow: var(--shadow-glow-teal);
        }
        
        .stage-indicator.completed {
            background-color: var(--color-success);
        }
        
        .dialog-content {
            height: 500px;
            overflow-y: auto;
            padding: var(--spacing-md);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }
        
        /* Сообщения чата */
        .message {
            display: flex;
            gap: var(--spacing-sm);
            max-width: 85%;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.user {
            margin-left: auto;
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .message.user .message-avatar {
            background-color: var(--color-accent-purple);
        }
        
        .message.assistant .message-avatar {
            background-color: var(--color-accent-teal);
        }
        
        .message-content {
            padding: var(--spacing-md);
            border-radius: var(--radius-lg);
            position: relative;
        }
        
        .message.user .message-content {
            background-color: var(--color-accent-purple);
            color: white;
            border-top-right-radius: var(--radius-sm);
        }
        
        .message.assistant .message-content {
            background-color: var(--color-bg-input);
            border-top-left-radius: var(--radius-sm);
        }
        
        .message-text {
            margin-bottom: var(--spacing-xs);
        }
        
        .message-time {
            font-size: 0.75rem;
            color: var(--color-text-muted);
            text-align: right;
        }
        
        /* Элементы процесса */
        .process-step {
            background-color: rgba(26, 54, 93, 0.5);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-top: var(--spacing-md);
            border-left: 4px solid var(--color-accent-teal);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 245, 212, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(0, 245, 212, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 245, 212, 0); }
        }
        
        .step-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-sm);
        }
        
        .step-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }
        
        .step-title i {
            color: var(--color-accent-teal);
        }
        
        .step-status {
            font-size: 0.875rem;
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            background-color: var(--color-bg-secondary);
        }
        
        .step-progress {
            height: 6px;
            background-color: var(--color-bg-secondary);
            border-radius: var(--radius-sm);
            margin-top: var(--spacing-sm);
            overflow: hidden;
        }
        
        .step-progress-bar {
            height: 100%;
            background-color: var(--color-accent-teal);
            width: 0%;
            transition: width 1s ease;
        }
        
        /* 3D визуализация молекулы */
        .molecule-visualization {
            height: 300px;
            background-color: rgba(10, 25, 41, 0.7);
            border-radius: var(--radius-lg);
            margin-top: var(--spacing-md);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .molecule-canvas {
            width: 100%;
            height: 100%;
        }
        
        .molecule-controls {
            position: absolute;
            bottom: var(--spacing-sm);
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: var(--spacing-sm);
            background-color: rgba(17, 34, 64, 0.8);
            padding: var(--spacing-sm);
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border);
        }
        
        .control-btn {
            background-color: var(--color-bg-input);
            border: none;
            color: var(--color-text-primary);
            width: 40px;
            height: 40px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .control-btn:hover {
            background-color: var(--color-accent-purple);
            transform: translateY(-2px);
        }
        
        /* Поле ввода */
        .input-container {
            padding: var(--spacing-md);
            border-top: 1px solid var(--color-border);
            background-color: var(--color-bg-card);
        }
        
        .input-wrapper {
            display: flex;
            gap: var(--spacing-sm);
        }
        
        .text-input {
            flex: 1;
            padding: var(--spacing-md);
            border-radius: var(--radius-lg);
            border: 2px solid var(--color-border);
            background-color: var(--color-bg-input);
            color: var(--color-text-primary);
            font-family: var(--font-primary);
            font-size: 1rem;
            resize: none;
            min-height: 60px;
            max-height: 120px;
            transition: all 0.3s ease;
        }
        
        .text-input:focus {
            outline: none;
            border-color: var(--color-accent-teal);
            box-shadow: var(--shadow-glow-teal);
        }
        
        .send-button {
            background: linear-gradient(135deg, var(--color-accent-purple), var(--color-accent-pink));
            border: none;
            border-radius: var(--radius-lg);
            color: white;
            font-weight: 600;
            padding: 0 var(--spacing-lg);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            min-width: 120px;
            justify-content: center;
        }
        
        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow-purple);
        }
        
        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Панель агента MARA */
        .agent-panel {
            position: fixed;
            bottom: var(--spacing-lg);
            right: var(--spacing-lg);
            width: 300px;
            background-color: var(--color-bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-border);
            box-shadow: var(--shadow-lg);
            z-index: 50;
            overflow: hidden;
            transform: translateY(calc(100% - 60px));
            transition: transform 0.3s ease;
        }
        
        .agent-panel:hover, .agent-panel.expanded {
            transform: translateY(0);
        }
        
        .agent-header {
            padding: var(--spacing-md);
            background-color: var(--color-bg-input);
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }
        
        .agent-title {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: 600;
        }
        
        .agent-title i {
            color: var(--color-accent-pink);
        }
        
        .agent-content {
            padding: var(--spacing-md);
            max-height: 300px;
            overflow-y: auto;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .agent-message {
            margin-bottom: var(--spacing-sm);
            padding: var(--spacing-sm);
            background-color: rgba(26, 54, 93, 0.3);
            border-radius: var(--radius-md);
            border-left: 3px solid var(--color-accent-pink);
        }
        
        /* Футер */
        .footer {
            padding: var(--spacing-lg) 0;
            border-top: 1px solid var(--color-border);
            text-align: center;
            color: var(--color-text-secondary);
            font-size: 0.9rem;
        }
        
        .cta-button {
            display: inline-block;
            margin-top: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-accent-teal), var(--color-accent-purple));
            color: var(--color-bg-primary);
            font-weight: 600;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-lg);
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 245, 212, 0.3);
        }
        
        /* Адаптивность */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .hero-subtitle {
                font-size: 1.2rem;
            }
            
            .dialog-container {
                border-radius: var(--radius-lg);
            }
            
            .message {
                max-width: 95%;
            }
            
            .agent-panel {
                width: 280px;
                right: var(--spacing-sm);
                bottom: var(--spacing-sm);
            }
            
            .molecule-controls {
                flex-wrap: wrap;
                justify-content: center;
                width: 90%;
            }
        }
        
        /* Анимации */
        @keyframes atomFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .atom {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--color-accent-teal);
            box-shadow: 0 0 10px var(--color-accent-teal);
            opacity: 0.7;
            animation: atomFloat 5s infinite ease-in-out;
        }
        
        /* Утилиты */
        .hidden {
            display: none !important;
        }
        
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: var(--spacing-sm);
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--color-accent-teal);
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Хедер -->
    <header class="header">
        <div class="container">
            <div class="logo-container">
                <div class="logo">
                    <i class="fas fa-atom"></i>
                </div>
                <div class="logo-text">MolecularGPT</div>
            </div>
        </div>
    </header>

    <!-- Основной контент -->
    <main>
        <!-- Герой секция -->
        <section class="hero">
            <div class="container">
                <h1 class="hero-title">Текст в Молекулу</h1>
                <p class="hero-subtitle">Универсальное Стандартизированное Молекулярное API</p>
                
                <!-- Диалоговое окно -->
                <div class="dialog-container">
                    <div class="dialog-header">
                        <div class="dialog-title">
                            <i class="fas fa-flask"></i>
                            Процесс генерации молекулы
                        </div>
                        <div class="pipeline-stages">
                            <div class="stage-indicator active" id="stage-1"></div>
                            <div class="stage-indicator" id="stage-2"></div>
                            <div class="stage-indicator" id="stage-3"></div>
                            <div class="stage-indicator" id="stage-4"></div>
                        </div>
                    </div>
                    
                    <div class="dialog-content" id="chat-messages">
                        <!-- Сообщения будут добавляться динамически -->
                        <div class="message assistant">
                            <div class="message-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="message-content">
                                <div class="message-text">Привет! Я MolecularGPT — система для генерации молекул из текстового описания. Опишите желаемую молекулу, её свойства или структуру, и я создам для вас 3D-модель с полным анализом.</div>
                                <div class="message-time">Только что</div>
                            </div>
                        </div>
                        
                        <div class="message user">
                            <div class="message-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="message-content">
                                <div class="message-text">Создай молекулу для нового противовоспалительного препарата с низкой токсичностью</div>
                                <div class="message-time">Только что</div>
                            </div>
                        </div>
                        
                        <!-- Этап процесса: MolecularGPT -->
                        <div class="process-step" id="step-1">
                            <div class="step-header">
                                <div class="step-title">
                                    <i class="fas fa-brain"></i>
                                    MolecularGPT: Анализ запроса
                                </div>
                                <div class="step-status" id="status-1">В процессе...</div>
                            </div>
                            <div class="step-progress">
                                <div class="step-progress-bar" id="progress-1"></div>
                            </div>
                            <div class="message-text" id="step-1-text">Анализирую запрос: "противовоспалительный препарат с низкой токсичностью". Определяю ключевые фармакофорные группы и целевые белки.</div>
                        </div>
                        
                        <!-- 3D визуализация молекулы -->
                        <div class="molecule-visualization hidden" id="molecule-viz">
                            <canvas class="molecule-canvas" id="molecule-canvas"></canvas>
                            <div class="molecule-controls">
                                <button class="control-btn" id="rotate-btn">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="control-btn" id="zoom-in-btn">
                                    <i class="fas fa-search-plus"></i>
                                </button>
                                <button class="control-btn" id="zoom-out-btn">
                                    <i class="fas fa-search-minus"></i>
                                </button>
                                <button class="control-btn" id="vr-btn">
                                    <i class="fas fa-vr-cardboard"></i>
                                </button>
                            </div>
                            
                            <!-- Плавающие атомы для анимации -->
                            <div class="atom" style="top: 20%; left: 15%; animation-delay: 0s;"></div>
                            <div class="atom" style="top: 60%; left: 80%; animation-delay: 1s;"></div>
                            <div class="atom" style="top: 80%; left: 40%; animation-delay: 2s;"></div>
                            <div class="atom" style="top: 30%; left: 70%; animation-delay: 3s;"></div>
                            <div class="atom" style="top: 70%; left: 20%; animation-delay: 4s;"></div>
                        </div>
                    </div>
                    
                    <!-- Поле ввода -->
                    <div class="input-container">
                        <div class="input-wrapper">
                            <textarea class="text-input" id="user-input" placeholder="Опишите молекулу или её свойства... Например: 'Молекула для лечения диабета с высокой биодоступностью'"></textarea>
                            <button class="send-button" id="send-btn">
                                <i class="fas fa-paper-plane"></i>
                                Сгенерировать
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Панель агента MARA -->
    <div class="agent-panel" id="agent-panel">
        <div class="agent-header" id="agent-toggle">
            <div class="agent-title">
                <i class="fas fa-microscope"></i>
                Ассистент MARA
            </div>
            <i class="fas fa-chevron-up" id="agent-chevron"></i>
        </div>
        <div class="agent-content" id="agent-content">
            <div class="agent-message">
                <strong>MolecularGPT</strong> анализирует ваш запрос, выделяя ключевые химические свойства и структурные требования.
            </div>
            <div class="agent-message">
                Следующий этап: <strong>DNA Diffusion</strong> сгенерирует базовую молекулярную структуру на основе анализа.
            </div>
            <div class="agent-message">
                Используйте кнопки управления для вращения и масштабирования 3D-модели молекулы.
            </div>
        </div>
    </div>

    <!-- Футер -->
    <footer class="footer">
        <div class="container">
            <p>Ephemeral & Immersive Science • Atomic Design • Текст в Молекулу API</p>
            <a href="#" class="cta-button" id="test-button">
                <i class="fas fa-vr-cardboard"></i>
                Протестировать в Nanome MARA
            </a>
            <p style="margin-top: var(--spacing-md);">© 2023 MolecularGPT. Все права защищены.</p>
        </div>
    </footer>

    <script>
        // Элементы DOM
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const moleculeViz = document.getElementById('molecule-viz');
        const agentPanel = document.getElementById('agent-panel');
        const agentToggle = document.getElementById('agent-toggle');
        const agentChevron = document.getElementById('agent-chevron');
        const testButton = document.getElementById('test-button');
        
        // Индикаторы этапов
        const stageIndicators = [
            document.getElementById('stage-1'),
            document.getElementById('stage-2'),
            document.getElementById('stage-3'),
            document.getElementById('stage-4')
        ];
        
        // Элементы этапов
        const step1 = document.getElementById('step-1');
        const step1Text = document.getElementById('step-1-text');
        const step1Status = document.getElementById('status-1');
        const step1Progress = document.getElementById('progress-1');
        
        // Состояние приложения
        let currentStage = 0;
        let isProcessing = false;
        let moleculeRotation = 0;
        let moleculeScale = 1;
        
        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            // Начинаем процесс с примером молекулы
            setTimeout(startMoleculeGeneration, 1500);
            
            // Настройка обработчиков событий
            sendBtn.addEventListener('click', handleUserInput);
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleUserInput();
                }
            });
            
            agentToggle.addEventListener('click', toggleAgentPanel);
            
            // Обработчики для кнопок управления молекулой
            document.getElementById('rotate-btn').addEventListener('click', toggleMoleculeRotation);
            document.getElementById('zoom-in-btn').addEventListener('click', () => zoomMolecule(1.2));
            document.getElementById('zoom-out-btn').addEventListener('click', () => zoomMolecule(0.8));
            document.getElementById('vr-btn').addEventListener('click', launchVRMode);
            
            // Обработчик для кнопки тестирования
            testButton.addEventListener('click', function(e) {
                e.preventDefault();
                alert('Запуск Nanome MARA... Иммерсивный режим активирован. Для полного опыта используйте VR-гарнитуру.');
            });
            
            // Автоматическое расширение текстового поля
            userInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
        });
        
        // Обработка ввода пользователя
        function handleUserInput() {
            const text = userInput.value.trim();
            if (!text || isProcessing) return;
            
            // Добавляем сообщение пользователя
            addMessage(text, 'user');
            userInput.value = '';
            userInput.style.height = 'auto';
            
            // Начинаем процесс генерации
            startMoleculeGeneration(text);
        }
        
        // Запуск процесса генерации молекулы
        function startMoleculeGeneration(userPrompt = null) {
            if (isProcessing) return;
            
            isProcessing = true;
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Обработка...';
            
            // Если пользователь ввел новый промпт
            if (userPrompt) {
                // Обновляем текст в первом этапе
                step1Text.textContent = `Анализирую запрос: "${userPrompt}". Определяю ключевые фармакофорные группы и целевые белки.`;
            }
            
            // Показываем индикатор набора текста
            showTypingIndicator();
            
            // Запускаем процесс по этапам
            setTimeout(() => {
                updateStage(0); // MolecularGPT
                simulateStep1(userPrompt);
            }, 1000);
        }
        
        // Обновление визуального отображения этапа
        function updateStage(stageIndex) {
            // Сбрасываем все индикаторы
            stageIndicators.forEach((indicator, index) => {
                indicator.classList.remove('active', 'completed');
                if (index < stageIndex) {
                    indicator.classList.add('completed');
                }
            });
            
            // Активируем текущий этап
            if (stageIndex < stageIndicators.length) {
                stageIndicators[stageIndex].classList.add('active');
            }
            
            currentStage = stageIndex;
        }
        
        // Симуляция этапа 1: MolecularGPT
        function simulateStep1(userPrompt) {
            // Обновляем прогресс
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(progressInterval);
                    
                    // Завершаем этап
                    step1Status.textContent = 'Завершено';
                    step1Status.style.color = 'var(--color-success)';
                    
                    // Переходим к следующему этапу
                    setTimeout(() => {
                        removeTypingIndicator();
                        addStep2();
                        updateStage(1);
                    }, 500);
                }
                step1Progress.style.width = `${progress}%`;
            }, 200);
        }
        
        // Добавление этапа 2: DNA Diffusion
        function addStep2() {
            const step2 = document.createElement('div');
            step2.className = 'process-step';
            step2.innerHTML = `
                <div class="step-header">
                    <div class="step-title">
                        <i class="fas fa-dna"></i>
                        DNA Diffusion: Генерация структуры
                    </div>
                    <div class="step-status" id="status-2">В процессе...</div>
                </div>
                <div class="step-progress">
                    <div class="step-progress-bar" id="progress-2"></div>
                </div>
                <div class="message-text" id="step-2-text">Генерирую молекулярную структуру на основе анализа. Создаю углеродный скелет и функциональные группы...</div>
            `;
            
            chatMessages.appendChild(step2);
            
            // Симуляция прогресса
            setTimeout(() => {
                const progress2 = document.getElementById('progress-2');
                const status2 = document.getElementById('status-2');
                const step2Text = document.getElementById('step-2-text');
                
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += Math.random() * 12;
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(progressInterval);
                        
                        // Завершаем этап
                        status2.textContent = 'Завершено';
                        status2.style.color = 'var(--color-success)';
                        step2Text.textContent += ' Структура сгенерирована успешно!';
                        
                        // Переходим к следующему этапу
                        setTimeout(() => {
                            addStep3();
                            updateStage(2);
                        }, 500);
                    }
                    progress2.style.width = `${progress}%`;
                    
                    // Обновляем текст на определенных процентах
                    if (progress > 30 && progress < 35) {
                        step2Text.textContent = 'Добавляю фармакофорные группы для противовоспалительной активности...';
                    } else if (progress > 60 && progress < 65) {
                        step2Text.textContent = 'Оптимизирую стерическую структуру для снижения токсичности...';
                    }
                }, 200);
            }, 500);
        }
        
        // Добавление этапа 3: MegaSyn
        function addStep3() {
            const step3 = document.createElement('div');
            step3.className = 'process-step';
            step3.innerHTML = `
                <div class="step-header">
                    <div class="step-title">
                        <i class="fas fa-chart-line"></i>
                        MegaSyn: Оптимизация и оценка
                    </div>
                    <div class="step-status" id="status-3">В процессе...</div>
                </div>
                <div class="step-progress">
                    <div class="step-progress-bar" id="progress-3"></div>
                </div>
                <div class="message-text" id="step-3-text">Оцениваю синтезируемость, активность и свойства молекулы. Анализирую ADMET-параметры...</div>
            `;
            
            chatMessages.appendChild(step3);
            
            // Показываем визуализацию молекулы
            moleculeViz.classList.remove('hidden');
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Симуляция прогресса
            setTimeout(() => {
                const progress3 = document.getElementById('progress-3');
                const status3 = document.getElementById('status-3');
                const step3Text = document.getElementById('step-3-text');
                
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += Math.random() * 10;
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(progressInterval);
                        
                        // Завершаем этап
                        status3.textContent = 'Завершено';
                        status3.style.color = 'var(--color-success)';
                        step3Text.textContent += ' Молекула оптимизирована! Синтезируемость: 87%, Активность: 92%, Токсичность: Низкая';
                        
                        // Переходим к следующему этапу
                        setTimeout(() => {
                            addStep4();
                            updateStage(3);
                        }, 500);
                    }
                    progress3.style.width = `${progress}%`;
                    
                    // Обновляем текст на определенных процентах
                    if (progress > 25 && progress < 30) {
                        step3Text.textContent = 'Расчет энергии связей и конформационный анализ...';
                    } else if (progress > 50 && progress < 55) {
                        step3Text.textContent = 'Оценка липофильности и растворимости...';
                    } else if (progress > 75 && progress < 80) {
                        step3Text.textContent = 'Прогноз метаболической стабильности...';
                    }
                }, 200);
            }, 500);
        }
        
        // Добавление этапа 4: Nanome XR
        function addStep4() {
            const step4 = document.createElement('div');
            step4.className = 'process-step';
            step4.innerHTML = `
                <div class="step-header">
                    <div class="step-title">
                        <i class="fas fa-vr-cardboard"></i>
                        Nanome XR: Интерактивное исследование
                    </div>
                    <div class="step-status" id="status-4">Доступно</div>
                </div>
                <div class="step-progress">
                    <div class="step-progress-bar" id="progress-4" style="width: 100%; background-color: var(--color-success);"></div>
                </div>
                <div class="message-text" id="step-4-text">Молекула готова для интерактивного исследования. Используйте элементы управления для вращения, масштабирования и изучения структуры.</div>
            `;
            
            chatMessages.appendChild(step4);
            
            // Добавляем сообщение ассистента о завершении
            setTimeout(() => {
                addMessage("Молекула успешно сгенерирована! Вы можете исследовать 3D-структуру, использовать элементы управления для детального изучения или протестировать её в иммерсивном режиме Nanome MARA.", 'assistant');
                
                // Восстанавливаем кнопку отправки
                isProcessing = false;
                sendBtn.disabled = false;
                sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Сгенерировать';
            }, 1000);
        }
        
        // Добавление сообщения в чат
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas ${sender === 'user' ? 'fa-user' : 'fa-robot'}"></i>
                </div>
                <div class="message-content">
                    <div class="message-text">${text}</div>
                    <div class="message-time">${time}</div>
                </div>
            `;
            
            // Удаляем индикатор набора текста, если он есть
            removeTypingIndicator();
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Показать индикатор набора текста
        function showTypingIndicator() {
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'message assistant';
            typingIndicator.id = 'typing-indicator';
            
            typingIndicator.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(typingIndicator);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Удалить индикатор набора текста
        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        // Управление панелью агента MARA
        function toggleAgentPanel() {
            agentPanel.classList.toggle('expanded');
            agentChevron.classList.toggle('fa-chevron-up');
            agentChevron.classList.toggle('fa-chevron-down');
        }
        
        // Управление молекулой
        function toggleMoleculeRotation() {
            const rotateBtn = document.getElementById('rotate-btn');
            const icon = rotateBtn.querySelector('i');
            
            if (icon.classList.contains('fa-sync-alt')) {
                icon.classList.remove('fa-sync-alt');
                icon.classList.add('fa-pause');
                rotateBtn.style.backgroundColor = 'var(--color-accent-purple)';
                
                // Запускаем анимацию вращения
                moleculeRotation = 0.01;
                animateMolecule();
            } else {
                icon.classList.remove('fa-pause');
                icon.classList.add('fa-sync-alt');
                rotateBtn.style.backgroundColor = '';
                moleculeRotation = 0;
            }
        }
        
        // Анимация молекулы
        function animateMolecule() {
            if (moleculeRotation !== 0) {
                // Здесь была бы логика вращения 3D-модели
                // В реальном приложении использовался бы Three.js или 3dmol.js
                requestAnimationFrame(animateMolecule);
            }
        }
        
        // Масштабирование молекулы
        function zoomMolecule(factor) {
            moleculeScale *= factor;
            // В реальном приложении здесь бы изменялся масштаб 3D-модели
        }
        
        // Запуск VR-режима
        function launchVRMode() {
            alert('Запуск иммерсивного VR-режима... Для полного опыта подключите VR-гарнитуру. В реальной реализации здесь бы запускалось приложение Nanome MARA.');
            
            // Анимация для кнопки VR
            const vrBtn = document.getElementById('vr-btn');
            vrBtn.style.backgroundColor = 'var(--color-accent-pink)';
            setTimeout(() => {
                vrBtn.style.backgroundColor = '';
            }, 1000);
        }
        
        // Имитация простой 3D-визуализации с помощью Canvas
        function initMoleculeVisualization() {
            const canvas = document.getElementById('molecule-canvas');
            const ctx = canvas.getContext('2d');
            
            // Установка размеров canvas
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // Простая анимация атомов и связей
            function drawMolecule() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Центр canvas
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                // Рисуем связи (линии)
                ctx.strokeStyle = 'rgba(0, 245, 212, 0.7)';
                ctx.lineWidth = 3;
                
                // Простая молекулярная структура (углеродный скелет)
                const atoms = [
                    {x: centerX, y: centerY, radius: 15, color: '#00f5d4'}, // Центральный атом
                    {x: centerX + 60, y: centerY - 40, radius: 12, color: '#9d4edd'},
                    {x: centerX - 60, y: centerY - 40, radius: 12, color: '#9d4edd'},
                    {x: centerX + 40, y: centerY + 60, radius: 12, color: '#ff6b9d'},
                    {x: centerX - 40, y: centerY + 60, radius: 12, color: '#ff6b9d'},
                    {x: centerX + 100, y: centerY + 20, radius: 10, color: '#8892b0'},
                    {x: centerX - 100, y: centerY + 20, radius: 10, color: '#8892b0'},
                ];
                
                // Связи между атомами
                const bonds = [
                    [0, 1], [0, 2], [0, 3], [0, 4],
                    [1, 5], [2, 6]
                ];
                
                // Рисуем связи
                bonds.forEach(bond => {
                    const atom1 = atoms[bond[0]];
                    const atom2 = atoms[bond[1]];
                    
                    ctx.beginPath();
                    ctx.moveTo(atom1.x, atom1.y);
                    ctx.lineTo(atom2.x, atom2.y);
                    ctx.stroke();
                });
                
                // Рисуем атомы
                atoms.forEach(atom => {
                    ctx.beginPath();
                    ctx.arc(atom.x, atom.y, atom.radius, 0, Math.PI * 2);
                    ctx.fillStyle = atom.color;
                    ctx.fill();
                    
                    // Свечение
                    ctx.shadowColor = atom.color;
                    ctx.shadowBlur = 15;
                    ctx.fill();
                    ctx.shadowBlur = 0;
                });
                
                // Добавляем вращение, если активно
                if (moleculeRotation !== 0) {
                    // Простейшее вращение - изменение позиций атомов
                    const time = Date.now() * 0.001;
                    atoms.forEach((atom, index) => {
                        if (index > 0) { // Не вращаем центральный атом
                            const angle = time + index;
                            const radius = 60 + (index % 3) * 20;
                            atom.x = centerX + Math.cos(angle) * radius;
                            atom.y = centerY + Math.sin(angle) * radius;
                        }
                    });
                }
                
                requestAnimationFrame(drawMolecule);
            }
            
            drawMolecule();
            
            // Обработка изменения размера окна
            window.addEventListener('resize', function() {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
            });
        }
        
        // Инициализация визуализации молекулы после загрузки страницы
        setTimeout(initMoleculeVisualization, 500);
        
        // Добавляем случайные сообщения от агента MARA
        function addRandomAgentMessage() {
            const messages = [
                "MolecularGPT использует трансформерные архитектуры для понимания химического контекста.",
                "DNA Diffusion создает молекулы через процесс, аналогичный диффузии в генеративных моделях.",
                "MegaSyn оценивает более 50 параметров для оптимизации молекул под конкретные задачи.",
                "Вы можете исследовать сгенерированную молекулу в VR-среде с помощью Nanome XR.",
                "Попробуйте запросить молекулу с конкретными свойствами: высокой растворимостью, низким logP и т.д."
            ];
            
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            const agentContent = document.getElementById('agent-content');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'agent-message';
            messageDiv.innerHTML = `<strong>MARA:</strong> ${randomMessage}`;
            
            agentContent.appendChild(messageDiv);
            agentContent.scrollTop = agentContent.scrollHeight;
            
            // Планируем следующее сообщение через случайный интервал
            setTimeout(addRandomAgentMessage, 15000 + Math.random() * 15000);
        }
        
        // Запускаем случайные сообщения агента
        setTimeout(addRandomAgentMessage, 5000);
    </script>
</body>
</html>
